FROM httpd:2.4-alpine

ENV CKAN_PORT=5000
ENV PYCSW_PORT=8000
ENV BDN_PORT=5000
ENV PYCSW_CONTAINER_NAME=pycsw
ENV CKAN_CONTAINER_NAME=ckan
ENV BDN_CONTAINER_NAME=bdn
ENV APACHE_PORT=80
ENV APACHE_LOG_DIR=/var/log/apache
ENV APACHE_ROOT=/usr/local/apache2
ENV APACHE_DOCUMENT_ROOT=${APACHE_ROOT}/htdocs
ENV PROXY_SERVER_NAME=localhost

ENV PROXY_CKAN_LOCATION=/catalog
ENV PROXY_PYCSW_LOCATION=/csw
ENV PROXY_BDN_LOCATION=/bdn
ENV PROXY_PYCSW_PROXY_PASS=http://${PYCSW_CONTAINER_NAME}:${PYCSW_PORT}
ENV PROXY_CKAN_PROXY_PASS=http://${CKAN_CONTAINER_NAME}:${CKAN_PORT}
ENV PROXY_BDN_PROXY_PASS=http://${BDN_CONTAINER_NAME}:${BDN_PORT}

RUN mkdir -p ${APACHE_LOG_DIR}

COPY setup/httpd.conf ${APACHE_ROOT}/conf/httpd.conf
COPY setup/index.html ${APACHE_DOCUMENT_ROOT}/index.html

EXPOSE ${APACHE_PORT}